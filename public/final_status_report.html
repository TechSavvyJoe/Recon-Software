<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Recon Tracker - Final Status Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-good { color: #22c55e; background: #f0fdf4; }
        .status-warning { color: #f59e0b; background: #fffbeb; }
        .status-error { color: #ef4444; background: #fef2f2; }
        .status-item { 
            padding: 0.75rem; 
            margin: 0.5rem 0; 
            border-radius: 0.5rem; 
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center text-blue-600">Vehicle Reconditioning Tracker - Final Status Report</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- JavaScript Status -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">JavaScript Status</h2>
                <div id="js-status"></div>
            </div>
            
            <!-- Function Tests -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Function Tests</h2>
                <div id="function-status"></div>
            </div>
            
            <!-- Modal Tests -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Modal Functions</h2>
                <div id="modal-status"></div>
            </div>
            
            <!-- Data Management -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Data Management</h2>
                <div id="data-status"></div>
            </div>
            
            <!-- UI Components -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">UI Components</h2>
                <div id="ui-status"></div>
            </div>
            
            <!-- Overall Status -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Overall Status</h2>
                <div id="overall-status"></div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="mt-6 text-center">
            <a href="index.html" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 mr-4">
                Open Main Application
            </a>
            <button onclick="runFullTest()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600">
                Run Full Test
            </button>
        </div>
        
        <!-- Error Log -->
        <div class="mt-6 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">Error Log</h2>
            <div id="error-log" class="bg-gray-100 p-4 rounded font-mono text-sm max-h-40 overflow-y-auto"></div>
        </div>
    </div>
    
    <!-- Include main.js -->
    <script src="main.js"></script>
    
    <script>
        // Error logging
        const errorLog = [];
        const originalError = console.error;
        console.error = function(...args) {
            errorLog.push('[ERROR] ' + args.join(' '));
            updateErrorLog();
            originalError.apply(console, args);
        };
        
        function updateErrorLog() {
            const logEl = document.getElementById('error-log');
            if (logEl) {
                logEl.innerHTML = errorLog.length > 0 ? errorLog.join('\n') : 'No errors detected ✅';
            }
        }
        
        function createStatusItem(message, status) {
            return `<div class="status-item status-${status}">${message}</div>`;
        }
        
        function testJavaScript() {
            const statusDiv = document.getElementById('js-status');
            let html = '';
            
            // Test global variables
            const tests = [
                { name: 'currentVehicleData', check: () => typeof currentVehicleData !== 'undefined' },
                { name: 'RECON_STATUSES', check: () => typeof RECON_STATUSES !== 'undefined' && Array.isArray(RECON_STATUSES) },
                { name: 'WORKFLOW_STEPS', check: () => typeof WORKFLOW_STEPS !== 'undefined' && typeof WORKFLOW_STEPS === 'object' },
                { name: 'detailerNames', check: () => typeof detailerNames !== 'undefined' && Array.isArray(detailerNames) },
                { name: 'Data Count', check: () => currentVehicleData && currentVehicleData.length >= 0 }
            ];
            
            tests.forEach(test => {
                try {
                    const result = test.check();
                    const status = result ? 'good' : 'error';
                    const extra = test.name === 'Data Count' ? ` (${currentVehicleData?.length || 0} vehicles)` : '';
                    html += createStatusItem(`${test.name}: ${result ? '✅ PASS' : '❌ FAIL'}${extra}`, status);
                } catch (e) {
                    html += createStatusItem(`${test.name}: ❌ ERROR - ${e.message}`, 'error');
                }
            });
            
            statusDiv.innerHTML = html;
        }
        
        function testFunctions() {
            const statusDiv = document.getElementById('function-status');
            let html = '';
            
            const coreFunctions = [
                '$', 'showMessageModal', 'closeAllModals', 'getStatusColor', 'formatDate',
                'switchTab', 'renderDashboard', 'renderWorkflow', 'renderInventory', 'renderReports'
            ];
            
            coreFunctions.forEach(funcName => {
                try {
                    const func = eval(funcName);
                    const isFunction = typeof func === 'function';
                    const status = isFunction ? 'good' : 'error';
                    html += createStatusItem(`${funcName}(): ${isFunction ? '✅ AVAILABLE' : '❌ MISSING'}`, status);
                } catch (e) {
                    html += createStatusItem(`${funcName}(): ❌ ERROR - ${e.message}`, 'error');
                }
            });
            
            statusDiv.innerHTML = html;
        }
        
        function testModalFunctions() {
            const statusDiv = document.getElementById('modal-status');
            let html = '';
            
            const modalFunctions = [
                'window.showVehicleDetailModal', 'window.showAddVehicleModal', 'window.showStatusUpdateModal',
                'window.updateVehicleNotes', 'window.deleteVehicle', 'window.updateVehicleStatus'
            ];
            
            modalFunctions.forEach(funcName => {
                try {
                    const func = eval(funcName);
                    const isFunction = typeof func === 'function';
                    const status = isFunction ? 'good' : 'error';
                    html += createStatusItem(`${funcName.replace('window.', '')}: ${isFunction ? '✅ AVAILABLE' : '❌ MISSING'}`, status);
                } catch (e) {
                    html += createStatusItem(`${funcName.replace('window.', '')}: ❌ ERROR - ${e.message}`, 'error');
                }
            });
            
            statusDiv.innerHTML = html;
        }
        
        function testDataManagement() {
            const statusDiv = document.getElementById('data-status');
            let html = '';
            
            const dataFunctions = [
                'saveDataToStorage', 'loadDataFromStorage', 'getWorkflowStatus', 
                'determineCurrentStatus', 'getSampleData'
            ];
            
            dataFunctions.forEach(funcName => {
                try {
                    const func = eval(funcName);
                    const isFunction = typeof func === 'function';
                    const status = isFunction ? 'good' : 'error';
                    html += createStatusItem(`${funcName}(): ${isFunction ? '✅ AVAILABLE' : '❌ MISSING'}`, status);
                } catch (e) {
                    html += createStatusItem(`${funcName}(): ❌ ERROR - ${e.message}`, 'error');
                }
            });
            
            // Test sample data generation
            try {
                if (typeof getSampleData === 'function') {
                    const sampleData = getSampleData();
                    const status = Array.isArray(sampleData) && sampleData.length > 0 ? 'good' : 'warning';
                    html += createStatusItem(`Sample Data Generation: ${status === 'good' ? '✅' : '⚠️'} ${sampleData.length} vehicles`, status);
                }
            } catch (e) {
                html += createStatusItem(`Sample Data Generation: ❌ ERROR - ${e.message}`, 'error');
            }
            
            statusDiv.innerHTML = html;
        }
        
        function testUIComponents() {
            const statusDiv = document.getElementById('ui-status');
            let html = '';
            
            // Test if we can run render functions without errors
            const renderTests = [
                { name: 'Dashboard Render', func: 'renderDashboard' },
                { name: 'Workflow Render', func: 'renderWorkflow' },
                { name: 'Inventory Render', func: 'renderInventory' },
                { name: 'Reports Render', func: 'renderReports' }
            ];
            
            renderTests.forEach(test => {
                try {
                    if (typeof eval(test.func) === 'function') {
                        eval(test.func + '()');
                        html += createStatusItem(`${test.name}: ✅ EXECUTED`, 'good');
                    } else {
                        html += createStatusItem(`${test.name}: ❌ NOT AVAILABLE`, 'error');
                    }
                } catch (e) {
                    html += createStatusItem(`${test.name}: ⚠️ ERROR - ${e.message}`, 'warning');
                }
            });
            
            statusDiv.innerHTML = html;
        }
        
        function generateOverallStatus() {
            const statusDiv = document.getElementById('overall-status');
            
            // Count statuses from all sections
            let totalTests = 0;
            let passedTests = 0;
            let warningTests = 0;
            let failedTests = 0;
            
            document.querySelectorAll('.status-item').forEach(item => {
                totalTests++;
                if (item.classList.contains('status-good')) passedTests++;
                else if (item.classList.contains('status-warning')) warningTests++;
                else if (item.classList.contains('status-error')) failedTests++;
            });
            
            const passPercent = Math.round((passedTests / totalTests) * 100);
            let overallStatus = 'error';
            let statusText = 'CRITICAL ISSUES';
            
            if (passPercent >= 90) {
                overallStatus = 'good';
                statusText = 'EXCELLENT';
            } else if (passPercent >= 75) {
                overallStatus = 'warning';
                statusText = 'GOOD WITH MINOR ISSUES';
            } else if (passPercent >= 50) {
                overallStatus = 'warning';
                statusText = 'NEEDS ATTENTION';
            }
            
            statusDiv.innerHTML = `
                <div class="status-item status-${overallStatus}">
                    <h3 class="text-lg font-bold">Overall Status: ${statusText}</h3>
                    <p>✅ Passed: ${passedTests}/${totalTests} (${passPercent}%)</p>
                    ${warningTests > 0 ? `<p>⚠️ Warnings: ${warningTests}</p>` : ''}
                    ${failedTests > 0 ? `<p>❌ Failed: ${failedTests}</p>` : ''}
                    ${errorLog.length > 0 ? `<p>🔍 Errors Logged: ${errorLog.length}</p>` : ''}
                </div>
                <div class="mt-4">
                    <h4 class="font-bold mb-2">Application Features Status:</h4>
                    <div class="text-sm space-y-1">
                        <div>📊 Dashboard: ${passPercent >= 90 ? '✅' : passPercent >= 75 ? '⚠️' : '❌'} Functional</div>
                        <div>🔄 Workflow: ${passPercent >= 90 ? '✅' : passPercent >= 75 ? '⚠️' : '❌'} Functional</div>
                        <div>📋 Inventory: ${passPercent >= 90 ? '✅' : passPercent >= 75 ? '⚠️' : '❌'} Functional</div>
                        <div>📈 Reports: ${passPercent >= 90 ? '✅' : passPercent >= 75 ? '⚠️' : '❌'} Functional</div>
                        <div>💾 Data Persistence: ${passPercent >= 90 ? '✅' : passPercent >= 75 ? '⚠️' : '❌'} Functional</div>
                    </div>
                </div>
            `;
        }
        
        function runFullTest() {
            // Clear previous results
            errorLog.length = 0;
            
            setTimeout(() => {
                testJavaScript();
                testFunctions();
                testModalFunctions();
                testDataManagement();
                testUIComponents();
                generateOverallStatus();
                updateErrorLog();
            }, 500);
        }
        
        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runFullTest, 1000);
        });
    </script>
</body>
</html>
